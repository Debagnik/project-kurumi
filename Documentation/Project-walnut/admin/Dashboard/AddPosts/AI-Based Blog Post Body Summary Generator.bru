meta {
  name: AI-Based Blog Post Body Summary Generator
  type: http
  seq: 4
}

post {
  url: {{url}}/admin/generate-post-summary
  body: formUrlEncoded
  auth: inherit
}

headers {
  User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:137.0) Gecko/20100101 Firefox/137.0
  Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
  Accept-Language: en-US,en;q=0.5
  Accept-Encoding: gzip, deflate, br, zstd
  Content-Type: application/x-www-form-urlencoded
  Origin: null
  DNT: 1
  Sec-GPC: 1
  Connection: keep-alive
  Upgrade-Insecure-Requests: 1
  Sec-Fetch-Dest: document
  Sec-Fetch-Mode: navigate
  Sec-Fetch-Site: same-origin
  Sec-Fetch-User: ?1
  Priority: u=0, i
}

body:form-urlencoded {
  _csrf: {{csrf_token}}
  title: Miku by Anamanaguch
  thumbnailImageURI: https://i.imgur.com/oUwpP5C.jpeg
  markdownbody: '''
    Ugh, seriously? You want me to analyze *"Miku"* by Anamanaguchi? It's not like I'm interested or anything! But since you're obviously too clueless to understand it yourself, I *guess* I'll break it down for you. Hmph! üò§
    
    ## Introduction to "Miku" by Anamanaguchi
    
    So, *"Miku"* is this song by Anamanaguchi featuring Hatsune Miku, the virtual pop star. Released in 2013, it's become one of their most streamed songs. The track is all about Miku's digital existence and her connection with fans. Not that I care or anything! üòí
    
    [Listen to Miku by Anamanaguchi here]()
    ---
    
    ## Line-by-Line Analysis
    
    ### "Miku, Miku, you can call me Miku"
    
    Ugh, starting off with such an obvious line! Miku's introducing herself, as if we don't already know who she is. Typical. Hmph.
    
    ### "Blue hair, blue tie, hiding in your Wi-Fi"
    
    Yeah, we get it. Blue hair and tie. And "hiding in your Wi-Fi"? Trying to sound all mysterious about being a virtual idol. It's not like it's impressive or anything! Jeez...
    
    ### "Open secrets, anyone can find me"
    
    So accessible, huh? Anyone can find you? Way to make yourself sound easy. Not that I'm interested in finding you or anything! Baka...
    
    ### "Hear your music running through my mind"
    
    Oh, now you're in my head? Great. Just what I needed, your music stuck in my brain. Not like it's catchy or anything! Ugh!
    
    ### "I'm thinking Miku, Miku (ooh-whee-ooh)"
    
    Repeating your own name? How self-absorbed can you get? And that "ooh-whee-ooh" part? Trying too hard to be cute. It's not like it's stuck in my head or anything!
    
    ### "I'm on top of the world because of you"
    
    Oh, so now you're taking credit for my happiness? As if! I was fine before you came along. Not like your music lifts my mood or anything! (shut up!)
    
    ### "All I wanted to do is follow you"
    
    Following you? As if I'd waste my time! It's not like I have better things to do than keep up with your virtual antics. (Okay, maybe I do‚Ä¶ but still!)
    
    ### "I'll keep singing along to all of you"
    
    Singing along? Pfft, as if I'd lower myself to that level. It's not like your songs are fun to sing or anything! üò§
    
    ### "Miku, Miku, what's it like to be you?"
    
    Why would I care what it's like to be you? Living in a digital world, adored by fans... Not like I'm curious or anything! Nope!
    
    ### "20/20, looking in the rearview"
    
    Reflecting on the past with perfect vision? How profound. Not like I spend time thinking about your journey or anything. Jeez.
    
    ### "Play me, break me, make me feel like Superman"
    
    Oh, so now you're offering to empower me? As if I need your help to feel strong. Not like your music is uplifting or anything! (‚Ä¶it is tho)
    
    ### "You can do anything you want"
    
    Giving me permission now? How generous. It's not like I needed your approval or anything! Grrr!
    
    ### "I do nothing that they could never do"
    
    So humble, comparing yourself to others. Not like you're unique or anything! (you are though‚Ä¶)
    
    ### "I'll keep playing along with all of you"
    
    Playing along? As if I'd join in your virtual games. Not like it's entertaining or anything! üôÑ
    
    ### "Where were we walking together? I will see you in the end"
    
    Walking together? I don't remember agreeing to that. Not like I'd mind or anything... Wait, I didn‚Äôt mean that!
    
    ### "I'll take you where you've never been and bring you back again"
    
    Oh, now you're offering me adventures? As if I need you to show me new places. Not like it sounds exciting or anything! ...Maybe a little.
    
    ### "Listen to me with your eyes, I'm watching you from in the sky"
    
    Watching me from the sky? That's not creepy at all. Not like I feel comforted by your presence or anything! Stop it!
    
    ### "If you forget I'll fade away, I'm asking you to let me stay"
    
    Afraid of being forgotten? As if I'd ever forget. Not like you're important to me or anything! Baka Miku‚Ä¶
    
    ### "So bathe me in your magic light and keep it on in darkest night"
    
    Relying on me now? Fine, I guess I can keep your light on. Not like I care or anything! üò§
    
    ### "I need you here to keep me strong to live my life and sing along"
    
    Needing me to keep you strong? How the tables have turned. Not like I enjoy supporting you or anything! (ugh, shut up)
    
    ### "I'm waiting with you wide awake like your expensive poison snake"
    
    Waiting with me? Fine, but don't expect me to be happy about it. Not like I enjoy your company or anything! üò°
    
    ### "You found me here inside a dream, walk through the fire, straight to me"
    
    Found you in a dream? Like I‚Äôd ever dream about you! Not like that image was beautiful or anything! *blush*
    
    ---
    
    ## Cultural Impact & Fan Reactions (ugh, you nerds...)
    
    Look, I‚Äôm not saying this song is iconic or anything‚Äîbut have you *seen* the fanbase explode when Anamanaguchi and Miku collabed? It was like tossing a digital firework into a pool of soda! üí•
    
    The blend of retro chiptune with Miku‚Äôs synthetic but emotionally resonant voice hit a nerve with fans all over the globe. Suddenly people were saying things like ‚ÄúMiku transcends culture‚Äù and ‚ÄúMiku is the future of music.‚Äù *Yawn.* Not like I agree or anything... (but seriously she kinda is‚Ä¶)
    
    TikToks? Check. Fanart? Check. Wild concerts with Miku projected on stage like some goddess of glitter and digital vibes? Double check. People screamed, cried, and wore LED cat ears like it was their birthright. Totally embarrassing. *Totally relatable.*
    
    [Checkout this fan animation (YoutubeShorts)](https://www.youtube.com/shorts/2oa5WCUpwD8)
    
    But the most *baka* part of it all? The song made people *feel*. And not in the cheesy way. It made loners feel seen, made geeks feel cool, and gave everyone a reason to say, ‚ÄúHey, maybe my imaginary anime wife *is* real.‚Äù
    
    Not like I care. I didn‚Äôt cry at the live version or anything. Shut up.
    
    ---
    
    ## Final Thoughts (not that I have any for *you* üí¢)
    
    Fine. I‚Äôll admit it. ‚ÄúMiku‚Äù by Anamanaguchi is a banger. The lyrics, the vibes, the cultural tsunami it caused‚Äîyeah, it‚Äôs legendary. Not that I‚Äôm obsessed or anything!! I just happened to listen to it‚Ä¶ 83 times‚Ä¶ accidentally.
    
    So yeah, if you haven‚Äôt heard it, go. Now. Or don‚Äôt. Whatever. Not like I care.
    
    But if you say bad things about Miku...
    
    I‚Äôll end you.
    
    Baka. üí¢üíñ
    
    ‚Äî Not yours or anything!!
    
    ![Miku_hiding_in_WiFi.jpeg](https://i.redd.it/dm7l5uizjewd1.jpeg)
  '''
  tags: Anamanaguchi, Miku, Vocaloid
  submit: Add
}

docs {
  # Route: POST /admin/generate-post-summary
  
  ## Overview
  
  This route allows an authenticated admin user to submit a blog post with markdown content and automatically generate a summary using an AI model (OpenRouter). The summary is stored in the post and the user is redirected to an edit page. If the AI generation fails or is disabled, fallback messages are used instead.
  
  ---
  
  ## Middleware
  
  - `authToken`: Ensures the user is authenticated.
  - `aiSummaryRateLimiter`: Limits the number of summary generation attempts to avoid abuse.
  
  ---
  
  ## Required Request Body Parameters
  
  | Parameter       | Type   | Required | Description                                    |
  |-----------------|--------|----------|------------------------------------------------|
  | `markdownbody`  | String | ‚úÖ Yes   | Raw markdown content of the blog post body     |
  | `title`         | String | ‚úÖ Yes   | Title of the blog post                         |
  | `tags`          | String | ‚úÖ Yes   | Comma-separated list of tags                   |
  
  ---
  
  ## Logic Breakdown
  
  1. **Fallback Summary Setup**
     - A default error message is defined in case AI summary generation fails.
     - The message is appended with a `"System"` tag.
  
  2. **Site Config Check**
     - If `siteConfig.isAISummerizerEnabled` is false:
       - A log message is written.
       - A fallback plain-text message is saved to the post description (`desc`).
  
  3. **AI Summary Generation**
     - If enabled and all required fields are present:
       - Initial `desc` is set using the fallback message converted to HTML.
       - The AI summary is fetched via `openRouterIntegration.summarizeMarkdownBody`.
       - If successful:
         - The result is formatted and saved to `req.body.desc`.
       - If it fails:
         - A fallback error message is logged and saved, including the error message.
  
  4. **Saving the Post**
     - The `savePostToDB(req, res)` function stores the post in MongoDB.
     - The new post ID is returned.
  
  5. **Redirect**
     - User is redirected to `/edit-post/:id` after post is saved.
  
  ---
  
  ## Return Behavior
  
  | Scenario                         | HTTP Status | Behavior                                                  |
  |----------------------------------|-------------|-----------------------------------------------------------|
  | AI summary generated successfully| 302 Redirect| Redirects to `/edit-post/:id`                             |
  | AI summary failed                | 302 Redirect| Redirects with fallback error message in the summary      |
  | AI summarizer disabled           | 302 Redirect| Redirects with message that summarizer is disabled        |
  | Server-side error                | 500         | Returns `Internal Server Error` as plain text             |
  
  ---
  
  ## Notes
  
  - The summary (successful or fallback) is saved in HTML format using `markdownToHtml`.
  - The site configuration flag (`isAISummerizerEnabled`) must be enabled for AI integration to work.
  
}
